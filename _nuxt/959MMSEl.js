import{Z as H,I as Z,L as q,g as G,A as k,r as C,c as o,a as t,y as T,V as J,b as m,p as h,t as x,F as S,B as j,m as Q,v as W,l as D,X as ee,o as l,n as te}from"./W0gg2iT2.js";import{A as se}from"./CFEcHXgB.js";import{M as oe}from"./DemRzukj.js";import{X as V}from"./hq94hZ8v.js";import{I as le}from"./tbX-b2re.js";import{V as ae}from"./C0kn6q29.js";import{c as ne}from"./Dn-7A9HV.js";const ie="$s";function re(...d){const v=typeof d[d.length-1]=="string"?d.pop():void 0;typeof d[0]!="string"&&d.unshift(v);const[r,u]=d;if(!r||typeof r!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+r);if(u!==void 0&&typeof u!="function")throw new Error("[nuxt] [useState] init must be a function: "+u);const y=ie+r,w=H(),c=Z(w.payload.state,y);if(c.value===void 0&&u){const p=u();if(q(p))return w.payload.state[y]=p,p;c.value=p}return c}const ce=ne("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),de={class:"flex min-h-screen flex-col bg-slate-50"},ue={class:"sticky top-0 z-10 bg-slate-50/90 backdrop-blur"},pe={class:"flex items-center gap-3 px-4 pt-3 pb-2"},fe={class:"flex flex-col"},me={class:"text-[13px] font-medium text-slate-500"},he={class:"inline-flex items-center gap-1 text-[15px] font-semibold text-slate-900"},xe={class:"flex-1 overflow-y-auto px-4 pt-2 pb-32"},ge={key:0,class:"mt-4 text-center text-[12px] text-slate-400"},be={key:1,class:"space-y-3 pb-4"},ve={class:"flex-1 rounded-2xl border border-slate-100 bg-white px-3 py-2.5"},ye={class:"flex items-center justify-between gap-2"},we={class:"flex items-center gap-1.5"},_e={class:"text-[12px] font-semibold text-slate-900"},ke={key:0,class:"rounded-full bg-indigo-50 px-2 py-[2px] text-[10px] font-medium text-indigo-600"},Ce={key:1,class:"rounded-full bg-amber-50 px-2 py-[2px] text-[10px] font-medium text-amber-700"},Te={class:"text-[10px] text-slate-400"},Me={key:0,class:"mt-1 text-[12px] leading-snug text-slate-800 whitespace-pre-line"},Se={key:1,class:"mt-2 flex flex-wrap gap-2"},je=["onClick"],$e=["src"],Ie=["src"],Ae={class:"absolute bottom-1 right-1 rounded-full bg-black/60 px-1.5 py-0.5 text-[9px] font-medium text-white"},De={class:"fixed inset-x-0 bottom-0 z-10 border-t border-slate-200 bg-white px-4 pb-[calc(8px+env(safe-area-inset-bottom))] pt-2"},Ve={class:"flex gap-3"},Ke={class:"flex-1"},Be={key:0,class:"mt-2 flex gap-2 overflow-x-auto"},Le=["src"],Ne=["src"],Re=["onClick"],ze={class:"mt-2 flex items-center justify-between"},Fe={class:"flex items-center gap-1.5"},Ue={class:"flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border border-slate-200 bg-slate-50 text-slate-500 hover:bg-slate-100"},Ee={class:"flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border border-slate-200 bg-slate-50 text-slate-500 hover:bg-slate-100"},Pe=["disabled"],Oe=["src"],Xe=["src"],We=G({__name:"[id]",setup(d){const v=[{id:"TSK-0001",room:"1205",description:"แอร์ไม่เย็น มีเสียงดังตอนเปิดโหมดเย็น ขอช่างเช็กด่วน",status:"in_progress",updatedAt:"2025-11-13T09:24:00+07:00",currentStep:4,media:[]},{id:"TSK-0002",room:"803",description:"ไฟในห้องน้ำไม่ติด อาจเป็นที่เบรกเกอร์",status:"in_progress",updatedAt:"2025-11-13T08:10:00+07:00",currentStep:2,media:[]}],r=re("task-comments",()=>[{id:"CMT-0001",taskId:"TSK-0001",author:"ลูกบ้าน 1205",role:"customer",createdAt:"2025-11-13T09:15:00+07:00",message:"ตอนนี้แอร์มีเสียงดังต่อเนื่องเลยค่ะ ถ้าเป็นไปได้รบกวนเข้ามาดูภายในช่วงเช้านี้นะคะ",media:[{id:"CMT-0001-M1",type:"video",url:"https://www.w3schools.com/html/mov_bbb.mp4"}]},{id:"CMT-0002",taskId:"TSK-0001",author:"นาย สรวิชญ์ สมจิตร",role:"operator",createdAt:"2025-11-13T09:20:00+07:00",message:"รับทราบครับ ช่างจะขึ้นไปภายใน 10:30 น. ถ้าถึงแล้วจะโทรแจ้งลูกบ้านอีกครั้งครับ",media:[]},{id:"CMT-0003",taskId:"TSK-0002",author:"ลูกบ้าน 803",role:"customer",createdAt:"2025-11-13T08:05:00+07:00",message:"แนบรูปตู้ไฟให้ครับ เหมือนเบรกเกอร์ห้องน้ำจะตกอยู่",media:[{id:"CMT-0003-M1",type:"image",url:"https://images.pexels.com/photos/4107014/pexels-photo-4107014.jpeg"}]}]),u=ee(),y=J(),w=k(()=>u.params.id),c=k(()=>v.find(e=>e.id===w.value)||v[0]),p=k(()=>r.value.filter(a=>a.taskId===c.value.id)),K=["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],B=a=>{const e=new Date(a),n=new Date().getTime()-e.getTime(),i=Math.floor(n/(1e3*60*60*24)),E=e.getHours().toString().padStart(2,"0"),P=e.getMinutes().toString().padStart(2,"0"),_=`${E}:${P}`;if(i===0)return`วันนี้ · ${_}`;if(i===1)return`เมื่อวาน · ${_}`;if(i<=7)return`${i} วันก่อน · ${_}`;const O=e.getDate().toString().padStart(2,"0"),X=K[e.getMonth()],Y=e.getFullYear()+543;return`${O} ${X} ${Y} ${_}`},L=a=>B(a),N=a=>{const e=a.trim().split(" ").filter(Boolean);return e.length?e.length===1?e[0].slice(0,2):(e[0][0]+e[e.length-1][0]).toUpperCase():"?"},b=C(""),f=C([]),$=(a,e)=>{const s=a.target;s.files?.length&&(Array.from(s.files).forEach(n=>{const i=URL.createObjectURL(n);f.value.push({type:e,url:i})}),s.value="")},R=a=>{f.value.splice(a,1)},I=k(()=>b.value.trim().length>0||f.value.length>0),z=()=>{if(!I.value)return;const a=new Date().toISOString(),e=Date.now(),s={id:`CMT-${e}`,taskId:c.value.id,author:"ช่างส่วนกลาง",role:"operator",createdAt:a,message:b.value.trim(),media:f.value.map((n,i)=>({id:`CMT-${e}-M${i+1}`,type:n.type,url:n.url}))};r.value=[s,...r.value],b.value="",f.value=[]},F=()=>y.back(),M=C(!1),g=C(null),U=a=>{g.value={type:a.type,url:a.url},M.value=!0},A=()=>{M.value=!1,g.value=null};return(a,e)=>(l(),o("div",de,[t("header",ue,[t("div",pe,[t("button",{type:"button",class:"flex h-8 w-8 items-center justify-center rounded-full bg-white shadow-sm",onClick:F},[m(h(se),{class:"h-4 w-4 text-slate-700"})]),t("div",fe,[t("span",me," งาน "+x(c.value.id)+" · ห้อง "+x(c.value.room),1),t("span",he,[m(h(oe),{class:"h-4 w-4 text-indigo-500"}),e[3]||(e[3]=t("span",null,"คอมเมนต์หน้างาน",-1))])])])]),t("main",xe,[p.value.length?(l(),o("div",be,[(l(!0),o(S,null,j(p.value,s=>(l(),o("article",{key:s.id,class:"flex gap-3"},[t("div",{class:te(["mt-0.5 flex h-8 w-8 items-center justify-center rounded-full text-[11px] font-semibold",s.role==="operator"?"bg-indigo-100 text-indigo-700":"bg-amber-100 text-amber-700"])},x(N(s.author)),3),t("div",ve,[t("div",ye,[t("div",we,[t("p",_e,x(s.author),1),s.role==="operator"?(l(),o("span",ke," เจ้าหน้าที่ ")):(l(),o("span",Ce," ลูกบ้าน "))]),t("span",Te,x(L(s.createdAt)),1)]),s.message?(l(),o("p",Me,x(s.message),1)):T("",!0),s.media&&s.media.length?(l(),o("div",Se,[(l(!0),o(S,null,j(s.media,n=>(l(),o("button",{key:n.id,type:"button",class:"relative h-20 w-24 overflow-hidden rounded-xl bg-slate-100",onClick:i=>U(n)},[n.type==="image"?(l(),o("img",{key:0,src:n.url,class:"h-full w-full object-cover"},null,8,$e)):(l(),o("video",{key:1,src:n.url,class:"h-full w-full object-cover",muted:"",playsinline:""},null,8,Ie)),t("span",Ae,x(n.type==="image"?"รูปภาพ":"วิดีโอ"),1)],8,je))),128))])):T("",!0)])]))),128))])):(l(),o("p",ge," ยังไม่มีคอมเมนต์สำหรับงานนี้ "))]),t("footer",De,[t("div",Ve,[e[5]||(e[5]=t("div",{class:"mt-1 flex h-9 w-9 items-center justify-center rounded-full bg-indigo-100 text-[11px] font-semibold text-indigo-700"}," ช่าง ",-1)),t("div",Ke,[Q(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),rows:"2",class:"max-h-24 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 placeholder:text-slate-400 focus:border-indigo-400 focus:bg-white focus:outline-none focus:ring-2 focus:ring-indigo-100",placeholder:"เขียนคอมเมนต์ถึงลูกบ้าน หรือบันทึกหมายเหตุหน้างาน..."},null,512),[[W,b.value]]),f.value.length?(l(),o("div",Be,[(l(!0),o(S,null,j(f.value,(s,n)=>(l(),o("div",{key:n,class:"relative h-16 w-20 overflow-hidden rounded-xl bg-slate-100"},[s.type==="image"?(l(),o("img",{key:0,src:s.url,class:"h-full w-full object-cover"},null,8,Le)):(l(),o("video",{key:1,src:s.url,class:"h-full w-full object-cover",muted:"",playsinline:""},null,8,Ne)),t("button",{type:"button",class:"absolute right-1 top-1 flex h-5 w-5 items-center justify-center rounded-full bg-black/60 text-[10px] text-white",onClick:D(i=>R(n),["stop"])},[m(h(V),{class:"h-3 w-3"})],8,Re)]))),128))])):T("",!0),t("div",ze,[t("div",Fe,[t("label",Ue,[m(h(le),{class:"h-4 w-4"}),t("input",{type:"file",class:"hidden",multiple:"",accept:"image/*",onChange:e[1]||(e[1]=s=>$(s,"image"))},null,32)]),t("label",Ee,[m(h(ae),{class:"h-4 w-4"}),t("input",{type:"file",class:"hidden",multiple:"",accept:"video/*",onChange:e[2]||(e[2]=s=>$(s,"video"))},null,32)])]),t("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full bg-indigo-600 px-4 py-1.5 text-[11px] font-medium text-white shadow-sm disabled:cursor-not-allowed disabled:bg-slate-300",disabled:!I.value,onClick:z},[m(h(ce),{class:"h-3.5 w-3.5"}),e[4]||(e[4]=t("span",null,"ส่ง",-1))],8,Pe)])])])]),M.value&&g.value?(l(),o("div",{key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/80",onClick:D(A,["self"])},[t("button",{type:"button",class:"absolute right-4 top-4 flex h-9 w-9 items-center justify-center rounded-full bg-black/60 text-white shadow-lg",onClick:A},[m(h(V),{class:"h-5 w-5"})]),g.value.type==="image"?(l(),o("img",{key:0,src:g.value.url,class:"max-h-[90vh] max-w-[100vw] object-contain"},null,8,Oe)):(l(),o("video",{key:1,src:g.value.url,controls:"",autoplay:"",class:"max-h-[90vh] max-w-[100vw]"},null,8,Xe))])):T("",!0)]))}});export{We as default};
