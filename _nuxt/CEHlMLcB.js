import{g as N,c as r,o as a,a as t,D as q,t as d,y as n,F as H,B as P,s as T,p as e,w as U,b as h,n as v,r as F,A as p,E as R,G,H as J,I as K,J as X,K as Z,m as E,v as W,L as Y,M as ee,k as te,_ as se}from"./W0gg2iT2.js";import{_ as z}from"./D7RL2lsT.js";import{_ as oe}from"./BjTfba1Q.js";import{f as ae,M as re,C as O,S as le,a as ne,u as ie,b as de}from"./uqwrqM6q.js";import{u as ce}from"./F0CWOOrD.js";import{C as Q}from"./D0YaOiqp.js";import{I as ue}from"./tbX-b2re.js";import{V as pe}from"./C0kn6q29.js";import{M as xe}from"./DemRzukj.js";import{C as me}from"./C6TyFrC2.js";import{t as fe}from"./CZWVA7lt.js";import{u as ge}from"./C1zK1Oh0.js";import{u as be}from"./BqH7K42C.js";import{S as ve}from"./DP6LML0j.js";import{X as he}from"./hq94hZ8v.js";const ye={class:"relative overflow-hidden rounded-[26px] bg-gradient-to-br from-emerald-600 via-emerald-500 to-emerald-400 px-4 pt-4 pb-[18px] text-emerald-50 shadow-sm"},_e={class:"mt-2 text-[11px] text-emerald-50/80"},we=N({__name:"TasksHeader",props:{taskCount:{}},setup(g){return(x,l)=>(a(),r("section",ye,[l[0]||(l[0]=t("h1",{class:"mt-1 text-[20px] font-bold leading-snug"},"รายการแจ้งงาน",-1)),l[1]||(l[1]=t("p",{class:"mb-3 mt-0.5 text-[12px] leading-relaxed text-emerald-50/95"}," ดูสถานะงานที่ลูกค้าแจ้งทั้งหมด แตะเพื่อเปิดรายละเอียด ",-1)),q(x.$slots,"default"),t("p",_e," กำลังแสดง "+d(g.taskCount)+" งานตามตัวกรอง ",1)]))}}),ke={class:"mt-3"},Ce={class:"flex flex-col gap-2.5 pb-1"},Te={class:"flex flex-col gap-1"},Se={key:0,class:"text-xs font-semibold text-sky-700"},$e={class:"flex items-baseline justify-between gap-2"},De={class:"flex items-baseline gap-1.5"},Le={class:"text-sm font-semibold text-gray-900"},Me={key:0,class:"rounded-full border border-emerald-100 bg-emerald-50 px-1.5 py-[1px] text-[11px] font-medium text-emerald-700"},Fe={class:"text-xs text-gray-400"},Be={key:1,class:"inline-flex items-center gap-1 text-xs text-gray-600"},Ie={class:"mt-0.5 flex flex-wrap gap-x-3 gap-y-1.5"},je={class:"inline-flex items-center gap-1.5 text-xs text-gray-600"},Ae={key:2,class:"inline-flex items-center justify-center h-3.5 px-1.5 rounded-full bg-emerald-500 text-[10px] font-semibold text-white"},Ve={key:0,class:"inline-flex items-center gap-1 text-xs text-sky-600"},Ne={key:1,class:"inline-flex items-center gap-1 text-xs text-purple-600"},Re={key:0},Ee={key:1},He={class:"mt-1 text-[13px] leading-snug text-gray-600"},Pe={key:2,class:"mt-1 text-xs font-semibold text-red-500"},Ue={class:"flex items-center justify-center text-gray-400"},ze={key:0,class:"pt-6 pb-4 flex flex-col items-center justify-center text-center text-gray-400"},Oe=N({__name:"TaskList",props:{TaskData:{},isCustomer:{type:Boolean},isDealer:{type:Boolean}},setup(g){const x=ce(),l=i=>{const w={in_progress:`วันที่กำหนดแล้วเสร็จ (ในเวลาทำการ): ${i.eduExh48}`,done:i.endsv_job?`Finished ${i.endsv_job}`:"ยังไม่จบงาน"}[i.status]??"สถานะไม่ทราบ",s=i.status==="done"&&i.endsv_job?"text-green-500":"text-red-500";return{text:w,colorClass:s}},u=i=>{switch(i){case"in_progress":return"กำลังทำ";case"done":return"เสร็จแล้ว"}};return(i,m)=>{const w=oe;return a(),r("section",ke,[t("div",Ce,[(a(!0),r(H,null,P(g.TaskData,s=>(a(),T(w,{key:s.id,to:`/${g.isCustomer?"customer":"employee"}/task/${s.ticket}`,onClick:D=>e(x).setList(s),class:"relative grid grid-cols-[1fr,auto] items-stretch gap-2.5 rounded-[22px] bg-white px-3.5 py-3 text-inherit shadow-[0_14px_34px_rgba(15,23,42,0.08)] no-underline transition-transform transition-shadow active:scale-[0.985] active:shadow-[0_10px_22px_rgba(15,23,42,0.16)]"},{default:U(()=>[t("div",Te,[s.schoolName?(a(),r("p",Se,d(s.schoolName),1)):n("",!0),t("div",$e,[t("div",De,[t("p",Le," หมายเลข "+d(s.ticket),1),s.isMine&&g.isCustomer?(a(),r("span",Me," ของฉัน ")):n("",!0)]),t("p",Fe,d(e(ae)(s.updatedAt)),1)]),s.room?(a(),r("div",Be,[h(e(re),{class:"h-3.5 w-3.5"}),t("span",null,"ห้อง "+d(s.room),1)])):n("",!0),t("div",Ie,[t("div",je,[s.status==="done"?(a(),T(e(Q),{key:0,class:"h-3.5 w-3.5 text-emerald-600"})):(a(),T(e(O),{key:1,class:"h-3.5 w-3.5 text-amber-600"})),t("span",null,d(u(s.status)),1),s.status==="in_progress"&&s.currentStep?(a(),r("span",Ae,d(s.currentStep)+"/5 ",1)):n("",!0)]),s.hasImage||s.hasVideo?(a(),r("div",Ve,[s.hasImage?(a(),T(e(ue),{key:0,class:"h-3.5 w-3.5"})):n("",!0),s.hasVideo?(a(),T(e(pe),{key:1,class:"h-3.5 w-3.5"})):n("",!0)])):n("",!0),(s.commentsCount??0)>0?(a(),r("div",Ne,[h(e(xe),{class:"h-3.5 w-3.5"}),t("span",null,d(s.commentsCount),1)])):n("",!0),s.canRate?(a(),r("div",{key:2,class:v(["inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px]",s.rating?"bg-amber-50 text-amber-700":"bg-slate-100 text-slate-500"])},[h(e(le),{class:v(["h-3.5 w-3.5",s.rating?"fill-amber-400 text-amber-400":"text-slate-400"])},null,8,["class"]),s.rating?(a(),r("span",Re,d(s.rating)+"/5",1)):(a(),r("span",Ee,"รอคะแนน"))],2)):n("",!0)]),t("p",He,d(s.description),1),s.dueDate?(a(),r("p",Pe," กำหนดแล้วเสร็จ: "+d(e(ne)(s.dueDate)),1)):n("",!0),g.isDealer?(a(),r("p",{key:3,class:v(["text-xs font-semibold",l(s).colorClass])},d(l(s).text),3)):n("",!0)]),t("div",Ue,[h(e(me),{class:"h-4 w-4"})])]),_:2},1032,["to","onClick"]))),128)),g.TaskData.length===0?(a(),r("div",ze,[...m[0]||(m[0]=[t("img",{src:z,alt:"ไม่มีรายการงาน",class:"mb-3 h-16 w-auto opacity-80"},null,-1),t("p",{class:"text-[13px]"},"ไม่พบงานในขณะนี้",-1)])])):n("",!0)])])}}}),Qe={all:"bg-blue-400 text-white shadow-sm ring-1 ring-white/60",in_progress:"bg-amber-400 text-white shadow-sm ring-1 ring-white/60",done:"bg-emerald-400 text-white shadow-sm ring-1 ring-white/60"},V=50;function qe(g){const x=F(""),l=F(""),u=F(V);let i=null;const m=p(()=>g.value??"in_progress"),{data:w,pending:s,error:D,refresh:k}=ge("task-list",()=>fe.getList(),{default:()=>[]});R(x,f=>{i&&clearTimeout(i),i=setTimeout(()=>{l.value=f},200)},{immediate:!0}),R([m,l],()=>{u.value=V});const b=p(()=>{const f={all:[],in_progress:[],done:[]};for(const c of w.value)f.all.push(c),c.status==="in_progress"&&f.in_progress.push(c),c.status==="done"&&f.done.push(c);return f}),S=p(()=>{const f=m.value==="all"?b.value.all:b.value[m.value],c=l.value.trim().toLowerCase();return c?f.filter(y=>{const M=y.ticket?.toLowerCase()??"",o=y.room?.toLowerCase()??"",_=y.description?.toLowerCase()??"";return M.includes(c)||o.includes(c)||_.includes(c)}):f}),B=p(()=>S.value.slice(0,u.value)),I=p(()=>u.value<S.value.length),j=()=>{u.value+=V},A=p(()=>b.value.all.length),$=p(()=>b.value.in_progress.length),C=p(()=>b.value.done.length),L=p(()=>{switch(m.value){default:return"bg-slate-50"}});return{selectedFilter:m,searchQuery:x,allTasks:w,filteredTasks:S,visibleTasks:B,totalTasks:A,inProgressCount:$,doneCount:C,pageBgClass:L,filterStyles:Qe,canLoadMore:I,loadMore:j,loading:s,error:D,refresh:k}}const Ge={class:"flex justify-center gap-2"},Je={class:"text-base font-bold"},Ke={class:"text-base font-bold"},Xe={class:"text-base font-bold"},Ze={class:"relative"},We={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-emerald-500/70"},Ye={key:1,class:"mt-4 space-y-3","aria-busy":"true","aria-live":"polite"},et={key:2,class:"pt-6 pb-4 flex flex-col items-center justify-center text-center text-gray-400"},tt=N({__name:"index",setup(g){const x=G(),l=be(),{isMobile:u}=J(x),{headerRef:i,showStickyHeader:m}=ie(u),w=p(()=>x.user?.userType==="e"),s=p(()=>x.user?.userType==="c"),D=p(()=>x.user?.userType==="d"),{searchQuery:k,filteredTasks:b,visibleTasks:S,totalTasks:B,inProgressCount:I,doneCount:j,pageBgClass:A,filterStyles:$,loading:C,canLoadMore:L,loadMore:f}=qe(K(l,"activeFilter")),c=F(null);let y=null;return X(()=>{"IntersectionObserver"in window&&(y=new IntersectionObserver(M=>{const o=M[0];o&&o.isIntersecting&&L.value&&!C.value&&f()},{root:null,rootMargin:"0px 0px 200px 0px",threshold:.1}),c.value&&y.observe(c.value))}),Z(()=>{y&&(y.disconnect(),y=null)}),(M,o)=>(a(),r("div",{class:v(["min-h-full pt-4 pb-6 transition-colors duration-300",[e(A),e(u)?"px-3":"px-4"]])},[h(we,{taskCount:e(b).length},{default:U(()=>[t("div",Ge,[t("button",{type:"button",onClick:o[0]||(o[0]=_=>e(l).setActiveFilter("in_progress")),class:v(["w-1/3 flex items-center gap-2 rounded-2xl px-3.5 py-2.5 backdrop-blur transition active:scale-[0.98] border-2 border-white/70",e(l).activeFilter==="in_progress"?e($).in_progress:"bg-white/10 text-emerald-50/90 opacity-80"])},[h(e(O),{class:"h-5 w-5"}),t("div",null,[o[5]||(o[5]=t("p",{class:"text-[11px] opacity-90"},"กำลังดำเนินการ",-1)),t("p",Je,d(e(I)),1)])],2),t("button",{type:"button",onClick:o[1]||(o[1]=_=>e(l).setActiveFilter("done")),class:v(["w-1/3 flex items-center gap-2 rounded-2xl px-3.5 py-2.5 backdrop-blur transition active:scale-[0.98] border-2 border-white/70",e(l).activeFilter==="done"?e($).done:"bg-white/10 text-emerald-50/90 opacity-80"])},[h(e(Q),{class:"h-5 w-5"}),t("div",null,[o[6]||(o[6]=t("p",{class:"text-[11px] opacity-90"},"เสร็จแล้ว",-1)),t("p",Ke,d(e(j)),1)])],2),e(w)?n("",!0):(a(),r("button",{key:0,type:"button",onClick:o[2]||(o[2]=_=>e(l).setActiveFilter("all")),class:v(["w-1/3 flex items-center gap-2 rounded-2xl px-3.5 py-2.5 backdrop-blur transition active:scale-[0.98] border-2 border-white/70",e(l).activeFilter==="all"?e($).all:"bg-white/10 text-emerald-50/90 opacity-80"])},[h(e(de),{class:"h-5 w-5"}),t("div",null,[o[7]||(o[7]=t("p",{class:"text-[11px] opacity-90"},"งานทั้งหมด",-1)),t("p",Xe,d(e(B)),1)])],2))])]),_:1},8,["taskCount"]),t("section",{class:v(e(u)?"sticky -top-3 z-30":"")},[t("div",{class:v([e(u)?"-mx-3":"-mx-4",e(m)?"bg-slate-50/90 backdrop-blur supports-[backdrop-filter]:bg-slate-50/70 border-b border-slate-200/70 shadow-sm rounded-b-2xl":""])},[t("div",{class:v(["pt-2 pb-2",e(u)?"px-3":"px-4"])},[t("div",Ze,[t("span",We,[h(e(ve),{class:"h-4 w-4"})]),E(t("input",{"onUpdate:modelValue":o[3]||(o[3]=_=>Y(k)?k.value=_:null),type:"text",inputmode:"search",placeholder:"ค้นหาจากเลขที่งาน ห้อง หรือคำอธิบาย",class:"w-full rounded-2xl border border-emerald-100 bg-white/90 py-2 pl-9 pr-8 text-sm text-gray-800 shadow-sm outline-none ring-0 placeholder:text-gray-400 focus:border-emerald-400 focus:bg-white focus:shadow-[0_10px_24px_rgba(15,23,42,0.08)] focus:ring-2 focus:ring-emerald-200"},null,512),[[W,e(k)]]),e(k)?(a(),r("button",{key:0,type:"button",onClick:o[4]||(o[4]=_=>k.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 active:scale-95"},[h(e(he),{class:"h-4 w-4"})])):n("",!0)])],2)],2)],2),t("div",{ref_key:"headerRef",ref:i},null,512),!e(C)&&e(b).length>0?(a(),T(Oe,{key:0,TaskData:e(S),isCustomer:e(s),isDealer:e(D)},null,8,["TaskData","isCustomer","isDealer"])):n("",!0),E(t("div",{ref_key:"infiniteScrollTrigger",ref:c,class:"h-10 w-full flex items-center justify-center text-xs text-gray-400"}," เลื่อนลงเพื่อโหลดงานเพิ่ม... ",512),[[ee,!e(C)&&e(L)&&e(b).length>0]]),e(C)?(a(),r("section",Ye,[o[9]||(o[9]=t("div",{class:"flex items-center justify-center gap-2 text-emerald-700/80 text-sm"},[t("span",{class:"spinner"}),t("span",null,"กำลังโหลดรายการงาน...")],-1)),(a(),r(H,null,P(3,_=>t("div",{key:_,class:"skeleton-card rounded-2xl border border-emerald-100 bg-white/80 p-3 shadow-sm"},[...o[8]||(o[8]=[te('<div class="flex items-start gap-3" data-v-4b1747e9><div class="flex-1 space-y-2" data-v-4b1747e9><div class="skeleton h-4 w-2/5 rounded" data-v-4b1747e9></div><div class="skeleton h-3 w-full rounded" data-v-4b1747e9></div><div class="skeleton h-3 w-4/5 rounded" data-v-4b1747e9></div><div class="flex gap-2 pt-1" data-v-4b1747e9><div class="skeleton h-3 w-16 rounded-full" data-v-4b1747e9></div><div class="skeleton h-3 w-20 rounded-full" data-v-4b1747e9></div></div></div></div>',1)])])),64))])):!e(C)&&e(b).length===0?(a(),r("section",et,[...o[10]||(o[10]=[t("img",{src:z,alt:"ไม่มีรายการงาน",class:"mb-3 h-16 w-auto opacity-80"},null,-1),t("p",{class:"text-[13px]"},"ไม่พบงานในขณะนี้",-1)])])):n("",!0)],2))}}),bt=se(tt,[["__scopeId","data-v-4b1747e9"]]);export{bt as L};
